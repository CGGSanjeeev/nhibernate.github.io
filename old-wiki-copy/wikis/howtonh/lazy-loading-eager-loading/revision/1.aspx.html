

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head><meta http-equiv="X-UA-Compatible" content="IE=7" /><meta name="robots" content="index,follow" />
<meta name="description" content="The official NHibernate community site. Download NHibernate. Read blogs. Contribute to the NHibernate Wiki. Find reference documentation." />
<meta name="keywords" content="NHibernate, NHibernate Contrib, community, Burrow, Downloads" />
<meta name="GENERATOR" content="CommunityServer 2008.5 SP1 (Build: 31106.3070)" />
<link rel="shortcut icon" type="image/ico" href="../../../../favicon.ico" />
<link rel="alternate" type="application/rss+xml" title="Lazy loading - eager loading (RSS 2.0)" href="../rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="How to (RSS 2.0)" href="http://nhforge.org/wikis/howtonh/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="gabriel.schenker&#39;s Announcements (RSS 2.0)" href="../../../../members/gabriel.schenker/announcements/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="gabriel.schenker&#39;s Comments (RSS 2.0)" href="../../../../members/gabriel.schenker/comments/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="gabriel.schenker&#39;s Activities (RSS 2.0)" href="../../../../members/gabriel.schenker/activities/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="gabriel.schenker&#39;s Friends Activity (RSS 2.0)" href="../../../../members/gabriel.schenker/activities/friendrss.aspx"  />

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <style type="text/css"> body { font-size: 84%; } </style>
        <link rel="stylesheet" href="../../../../themes/hawaii/style/Common.css" type="text/css" media="screen,print" />
        <link rel="stylesheet" href="../../../../themes/hawaii/style/common_print.css" type="text/css" media="print" />
        
    
    <link rel="stylesheet" href="../../../../Themes/hawaii/style/wiki.css" type="text/css" media="screen,print" />
	

        <link rel="stylesheet" href="../../../../themes/hawaii/style/DynamicStyle.aspx.css" type="text/css" media="screen" />
        <!--[if lte IE 6]>
            <link rel="stylesheet" href="/themes/hawaii/style/ie6.css" type="text/css" media="screen" />
        <![endif]-->
    <meta name="google-site-verification" content="u9qihpHbzSFdf2ypCUvCQrj9IJkANGzorC8zMk0859M" />
<title>
	Lazy loading - eager loading: Revision #1 - NHibernate Forge
</title></head>
	<body>
		<form name="aspnetForm" method="post" action="1.aspx.html" id="aspnetForm">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTE2ODYxODYyODBkGAEFHl9fQ29udHJvbHNSZXF1aXJlUG9zdEJhY2tLZXlfXxYBBTBjdGwwMCRjdGwwMCRzciRzciRjdGwwMCRjdGwwMCRUaXRsZUJhclNlYXJjaFRleHRS2dku67jB2SYXikwjMUBFR1YWDw==" />
</div>


<script src="../../../../WebResource.axd%3Fd=0gbcOAOlbWsHyCtP1tLKZQbpxrEkhg31E8L04T1x-hMLrsMonvmUNQvxBohSywWHueFgWT841lW9e5k7Gp2DbPsOLeN3Sv3SB7czfVSlQGxYOHnJcLlKfh3v9vlcjJ9ggvps0fjahw73J3SVYQmGvS0rXng1&amp;t=634395149500000000" type="text/javascript"></script>
<script src="../../../../WebResource.axd%3Fd=qXX_qxw7Y60qjc1NsxHnuIWUCy9JxjEUKLrY5KEQyuYhKzv3UmRPH805gTXU5edfSsLl7PHTIDuZbzGOp5UYEWeQ6anyqFa-m5TiNnZiD5MOrgiKWAZBgPyJ267gdCbk0_TpK2BaAhLvEgyM28dt9SYQ2UM1&amp;t=634395149500000000" type="text/javascript"></script>
<script src="../../../../WebResource.axd%3Fd=c5kkseX-7hUDg441H_iVoy5ws7YKvwS4KliHEKHuRl5UdJkUU5Jbdf2sxzCcbfyn6sqe17DzqhSTfAyV8nyJKMHhScl2IzjSz37RVYryN9Omis3K0NCj_OJ4fHZH3n9_IPBlNLVyYL45kjJL_zhydrkKTi3FfxaImDeS_1JZIO7o9iFs0&amp;t=634395149500000000" type="text/javascript"></script>
						

			

		    
		        <div id="CommonHeader">
		            <div class="Common">
		                <div id="CommonHeaderTitleArea">
		                    <table cellpadding="0" cellspacing="0" border="0"><tr valign="middle">
		                        <td><div style="margin-right: 10px;"><img src="../../../../cfs-file_ashx/key/CommunityServer.Components.SiteFiles/logos/LogoNH.gif" alt="" style="border-width:0px;" /></div></td>
		                        <td>
		                            <div class="CommonHeaderTitle">NHibernate Forge</div>
		                            <div class="CommonHeaderTitleDescription">The official new home for the NHibernate for .NET community</div>
		                        </td>
		                    </tr></table>
		                </div>
		                <div id="CommonHeaderUserArea">
		                    <table cellpadding="0" cellspacing="0" border="0"><tr valign="top"><td>
                                <div id="CommonHeaderUserContent">
                                    <div id="CommonHeaderUserWelcome">
                                        
        <a href="http://nhforge.org/login.aspx?ReturnUrl=%2fwikis%2fhowtonh%2flazy-loading-eager-loading%2frevision%2f1.aspx">Sign in </a>
         | <a href="../../../../user/CreateUser.aspx%3FReturnUrl=.html">Join</a>
        | <a href="http://dev.communityserver.com/r.ashx?K&amp;siteurl=wikis.wiki_Page_ViewRevision">Help</a>
     


                                    </div>
                                </div>
                            </td></tr></table>
                        </div>
                    </div>
                </div>
                <div id="CommonNavigation">
                    <div class="Common"><div class="Inner">
                        <ul>
                                
                                <li><a href="../../../../index.html">Home</a></li>
                            
                                
                                <li><a href="../../../../blogs/nhibernate.html">Blog</a></li>
                            
                                <li><a class="Selected" href="../../../index.html">Wikis</a></li>
                                
                            
                                
                                <li><a href="../../../../groups/index.html">Groups</a></li>
                            
                                
                                <li><a href="../../../../doc/nh/en/index.html">Reference</a></li>
                            
                                
                                <li><a href="http://nhibernate.jira.com">Issue tracker</a></li>
                            
                                
                                <li><a href="https://github.com/nhibernate/nhibernate-core">Source Code</a></li>
                            </ul>
                        <div style="clear: both;"></div>
                     </div></div>
                </div>
                
                        <div id="CommonNavigation2">
                            <div class="Common"><div class="Inner">
                                <ul>
                    
                        
                        <li><a href="../../../general/default.aspx.html">General</a></li>
                    
                        <li><a class="Selected" href="../../default.aspx.html">How to</a></li>
                        
                    
                        
                        <li><a href="../../../patternsandpractices/default.aspx.html">Patterns&Practices</a></li>
                    
                                </ul>
                            </div></div>
                        </div>
                    
                <div id="CommonNavigationShadow">
                    
    
    <div class="CommonBreadCrumbArea"><div class="Common">
        <a href="../../../index.html">Wikis</a>
        &raquo;
        <a href="../../default.aspx.html">How to</a>
        &raquo;
        <a href="../../lazy-loading-eager-loading.aspx.html">Lazy loading - eager loading</a>
        &raquo;
        Revision #1
    </div></div>


                </div>
		    
                        
            <div class="Common">
            
                
            
                <div id="CommonSearch">
                    
    
        
                <div class="CommonSearchArea">
                    <div class="CommonSearchRoundTop"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                    <div class="CommonSearchContent"><div class="CommonSearchContentInner">
                        <input name="ctl00$ctl00$sr$sr$ctl00$ctl00$TitleBarSearchText" type="text" maxlength="64" size="15" id="ctl00_ctl00_sr_sr_ctl00_ctl00_TitleBarSearchText" onclick="if(this.defaultValue==this.value) this.value='';" onblur="if(this.value=='') this.value=this.defaultValue;" onkeydown="return KeyDownHandlerctl00_ctl00_sr_sr_ctl00_ctl00_TitleBarSearchButton(event);" /><input type="submit" name="ctl00$ctl00$sr$sr$ctl00$ctl00$TitleBarSearchButton" value="Â " id="ctl00_ctl00_sr_sr_ctl00_ctl00_TitleBarSearchButton" class="CommonSearchButton" />
                    </div></div>
                    <div class="CommonSearchRoundBottom"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                </div>
            
    

                </div>
                <div id="CommonTitle">
                    
    
    <h1 class="CommonTitle">Lazy loading - eager loading: 
            Revision #1
        </h1>


                </div>
                <div style="clear: both;"></div>
			    <div id="CommonSidebarRight">
			        
    
	<div class="CommonSidebar">
	    
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Shortcuts</h4>
	                    <div class="CommonContentBoxContent">
	            <ul class='CommonSidebarList'><li><a href="../../default.aspx.html">Home</a></li><li><a href="../rss.aspx">RSS feed for page</a></li></ul>
				        </div>
				        
			        </div>
	            
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Attachments</h4>
	                    <div class="CommonContentBoxContent">
	            <ul class="CommonSidebarList"><li><a href="../../../../cfs-file_ashx/key/CommunityServer.Blogs.Components.WeblogFiles/nhibernate/LazyLoadingEagerLoadingDomain.png">LazyLoadingEagerLoadingDomain.png</a></li><li><a href="../../../../cfs-file_ashx/key/CommunityServer.Blogs.Components.WeblogFiles/nhibernate/LazyLoadingEagerLoadingAggDomain.png">LazyLoadingEagerLoadingAggDomain.png</a></li></ul>
				        </div>
				        
			        </div>
	            
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Wiki Page Hierarchy</h4>
	                    <div class="CommonContentBoxContent">
	            <div><ul class="CommonHierarchicalList"><li><a href="../../mapping-a-view-and-schema-export-workaround.aspx.html">Mapping a view and Schema Export Workaround</a></li><li><a href="../../lazy-loading-eager-loading.aspx.html" class="Selected">Lazy loading - eager loading</a></li><li><a href="../../configure-log4net-for-use-with-nhibernate.aspx.html">Configure Log4Net for use with NHibernate</a></li><li><a href="../../get-unique-results-from-joined-queries.aspx.html">Get unique results from joined queries</a></li><li><a href="1.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01._expand(30, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../your-first-nhibernate-based-application.aspx.html">Your first NHibernate based application</a></li><li><a href="../../run-in-medium-trust.aspx.html">Run in Medium Trust</a></li><li><a href="../../pre-generate-lazy-loading-proxies.aspx.html">Pre-Generate Lazy Loading Proxies</a></li><li><a href="1.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01._expand(42, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../using-user-types.aspx.html">Using User Types</a></li><li><a href="../../lazy-loaded-one-to-one-with-nhibernate.aspx.html">Lazy Loaded One-To-One With NHibernate </a></li><li><a href="../../dynamically-change-user-info-in-connection-string.aspx.html">Dynamically change user info in connection string</a></li><li><a href="../../contextual-data-using-nhibernate-filters.aspx.html">Contextual data using NHibernate filters</a></li><li><a href="../../mapping-the-same-class-to-a-view-and-a-table-using-entity-name.aspx.html">Mapping the same class to a view and a table using entity-name</a></li><li><a href="../../creating-an-audit-log-using-nhibernate-events.aspx.html">Creating an Audit Log using NHibernate Events</a></li><li><a href="1.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01._expand(51, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../create-a-custom-message-interpolator-for-nhibernate-validator.aspx.html">Create a custom message interpolator for NHibernate Validator</a></li><li><a href="../../use-postgresql-arrays-with-nhibernate.aspx.html">Use PostgreSQL Arrays with NHibernate</a></li><li><a href="../../retrieve-a-nested-component-with-criteria-api.aspx.html">Retrieve a nested component with Criteria API</a></li><li><a href="../../tuning-queries-with-ms-sqlserver.aspx.html">Tuning queries with MS SQLServer</a></li><li><a href="../../nhibernate-concurrency-with-oracle-s-ora-rowscn.aspx.html">NHibernate concurrency with Oracle&#39;s ORA_ROWSCN</a></li><li><a href="../../the-best-way-to-get-nhibernate-community-support-submit-precise-description-of-the-problem.aspx.html">The best way to get NHibernate community support ? Submit precise description of the problem</a></li><li><a href="../../simple-audit-metadata-and-logical-deletion-of-business-entities.aspx.html">Simple audit metadata and logical deletion of business entities</a></li><li><a href="../../prefent-nhibernate-from-saving-default-relations.aspx.html">Prefent NHibernate from saving default relations</a></li><li><a href="../../creating-a-custom-id-generator-for-nhibernate.aspx.html">Creating a custom id generator for nHibernate</a></li><li><a href="1.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01._expand(66, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../finding-dirty-properties-in-nhibernate.aspx.html">Finding Dirty Properties in NHibernate</a></li><li><a href="../../currentsessioncontext-for-desktop-development.aspx.html">CurrentSessionContext for Desktop development</a></li><li><a href="../../customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html">Customizing Fluent Nhibernate&#39;s AutoPersistenceModel Conventions</a></li><li><a href="../../how-to-use-db2hbm.aspx.html">How to use Db2hbm</a></li><li><a href="../../localization-techniques.aspx.html">Localization techniques</a></li><li><a href="../../calling-oracle-procedure-inside-package.aspx.html">Calling Oracle Procedure inside package</a></li><li><a href="../../how-to-get-help-with-nhibernate.aspx.html">How To Get Help with NHibernate</a></li><li><a href="../../nhibernate-features.aspx.html">NHibernate Features</a></li><li><a href="../../using-nlog-via-common-logging-with-nhibernate.aspx.html">Using NLog via Common.Logging with NHibernate</a></li><li><a href="../../keeping-entity-state-over-multiple-nhibernate-sessions.aspx.html">Keeping Entity State Over Multiple NHibernate Sessions</a></li><li><a href="../../enumerating-first-level-cache-entities.aspx.html">Enumerating First Level Cache Entities</a></li><li><a href="../../hilo-generator-with-node-suffix.aspx.html">HiLo Generator With Node Suffix</a></li><li><a href="../../nhibernate-audit-trails-and-onpreinsert-onpreupdate-event-listeners-vs-save-update-event-listeners.aspx.html">Changing Values in NHibernate Events</a></li><li><a href="../../conventionmodelmapper-amp-net-4-iset-lt-gt.aspx.html">ConventionModelMapper &amp; .net 4 ISet&lt;&gt;</a></li><li><a href="../../conventionmodelmapper-change-manytoone-column-name.aspx.html">ConventionModelMapper - change ManyToOne column name</a></li><li><a href="../../view-the-xml-generated-when-mapping-by-code.aspx.html">View the xml generated when mapping by code</a></li><li><a href="../../net-type-generation-for-nhibernate-mapping-collections.aspx.html">.NET type generation for NHibernate mapping collections</a></li><li><a href="../../a-fully-working-skeleton-for-sexy-loquacious-nh.aspx.html">A fully working skeleton for sexy Loquacious NH</a></li><li><a href="../../checking-if-an-unloaded-collection-contains-elements.aspx.html">Checking if an Unloaded Collection Contains Elements</a></li><li><a href="../../mapping-tables.aspx.html">Mapping tables</a></li><li><a href="../../wcf-nhibernate-entity-serialization.aspx.html">WCF + NHibernate: Entity Serialization</a></li></ul></div>
				        </div>
				        
			        </div>
	            
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Pages</h4>
	                    <div class="CommonContentBoxContent">
	            <div><ul class="CommonHierarchicalList"><li><a href="../../mapping-a-view-and-schema-export-workaround.aspx.html">Mapping a view and Schema Export Workaround</a></li><li><a href="../../lazy-loading-eager-loading.aspx.html" class="Selected">Lazy loading - eager loading</a></li><li><a href="../../configure-log4net-for-use-with-nhibernate.aspx.html">Configure Log4Net for use with NHibernate</a></li><li><a href="../../get-unique-results-from-joined-queries.aspx.html">Get unique results from joined queries</a></li><li><a href="1.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01._expand(30, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../your-first-nhibernate-based-application.aspx.html">Your first NHibernate based application</a></li><li><a href="../../run-in-medium-trust.aspx.html">Run in Medium Trust</a></li><li><a href="../../pre-generate-lazy-loading-proxies.aspx.html">Pre-Generate Lazy Loading Proxies</a></li><li><a href="1.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01._expand(42, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../using-user-types.aspx.html">Using User Types</a></li><li><a href="../../lazy-loaded-one-to-one-with-nhibernate.aspx.html">Lazy Loaded One-To-One With NHibernate </a></li><li><a href="../../dynamically-change-user-info-in-connection-string.aspx.html">Dynamically change user info in connection string</a></li><li><a href="../../contextual-data-using-nhibernate-filters.aspx.html">Contextual data using NHibernate filters</a></li><li><a href="../../mapping-the-same-class-to-a-view-and-a-table-using-entity-name.aspx.html">Mapping the same class to a view and a table using entity-name</a></li><li><a href="../../creating-an-audit-log-using-nhibernate-events.aspx.html">Creating an Audit Log using NHibernate Events</a></li><li><a href="1.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01._expand(51, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../create-a-custom-message-interpolator-for-nhibernate-validator.aspx.html">Create a custom message interpolator for NHibernate Validator</a></li><li><a href="../../use-postgresql-arrays-with-nhibernate.aspx.html">Use PostgreSQL Arrays with NHibernate</a></li><li><a href="../../retrieve-a-nested-component-with-criteria-api.aspx.html">Retrieve a nested component with Criteria API</a></li><li><a href="../../tuning-queries-with-ms-sqlserver.aspx.html">Tuning queries with MS SQLServer</a></li><li><a href="../../nhibernate-concurrency-with-oracle-s-ora-rowscn.aspx.html">NHibernate concurrency with Oracle&#39;s ORA_ROWSCN</a></li><li><a href="../../the-best-way-to-get-nhibernate-community-support-submit-precise-description-of-the-problem.aspx.html">The best way to get NHibernate community support ? Submit precise description of the problem</a></li><li><a href="../../simple-audit-metadata-and-logical-deletion-of-business-entities.aspx.html">Simple audit metadata and logical deletion of business entities</a></li><li><a href="../../prefent-nhibernate-from-saving-default-relations.aspx.html">Prefent NHibernate from saving default relations</a></li><li><a href="../../creating-a-custom-id-generator-for-nhibernate.aspx.html">Creating a custom id generator for nHibernate</a></li><li><a href="1.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01._expand(66, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../finding-dirty-properties-in-nhibernate.aspx.html">Finding Dirty Properties in NHibernate</a></li><li><a href="../../currentsessioncontext-for-desktop-development.aspx.html">CurrentSessionContext for Desktop development</a></li><li><a href="../../customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html">Customizing Fluent Nhibernate&#39;s AutoPersistenceModel Conventions</a></li><li><a href="../../how-to-use-db2hbm.aspx.html">How to use Db2hbm</a></li><li><a href="../../localization-techniques.aspx.html">Localization techniques</a></li><li><a href="../../calling-oracle-procedure-inside-package.aspx.html">Calling Oracle Procedure inside package</a></li><li><a href="../../how-to-get-help-with-nhibernate.aspx.html">How To Get Help with NHibernate</a></li><li><a href="../../nhibernate-features.aspx.html">NHibernate Features</a></li><li><a href="../../using-nlog-via-common-logging-with-nhibernate.aspx.html">Using NLog via Common.Logging with NHibernate</a></li><li><a href="../../keeping-entity-state-over-multiple-nhibernate-sessions.aspx.html">Keeping Entity State Over Multiple NHibernate Sessions</a></li><li><a href="../../enumerating-first-level-cache-entities.aspx.html">Enumerating First Level Cache Entities</a></li><li><a href="../../hilo-generator-with-node-suffix.aspx.html">HiLo Generator With Node Suffix</a></li><li><a href="../../nhibernate-audit-trails-and-onpreinsert-onpreupdate-event-listeners-vs-save-update-event-listeners.aspx.html">Changing Values in NHibernate Events</a></li><li><a href="../../conventionmodelmapper-amp-net-4-iset-lt-gt.aspx.html">ConventionModelMapper &amp; .net 4 ISet&lt;&gt;</a></li><li><a href="../../conventionmodelmapper-change-manytoone-column-name.aspx.html">ConventionModelMapper - change ManyToOne column name</a></li><li><a href="../../view-the-xml-generated-when-mapping-by-code.aspx.html">View the xml generated when mapping by code</a></li><li><a href="../../net-type-generation-for-nhibernate-mapping-collections.aspx.html">.NET type generation for NHibernate mapping collections</a></li><li><a href="../../a-fully-working-skeleton-for-sexy-loquacious-nh.aspx.html">A fully working skeleton for sexy Loquacious NH</a></li><li><a href="../../checking-if-an-unloaded-collection-contains-elements.aspx.html">Checking if an Unloaded Collection Contains Elements</a></li><li><a href="../../mapping-tables.aspx.html">Mapping tables</a></li><li><a href="../../wcf-nhibernate-entity-serialization.aspx.html">WCF + NHibernate: Entity Serialization</a></li></ul></div>
				        </div>
				        
			        </div>
	            
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Tags</h4>
	                    <div class="CommonContentBoxContent">
	            <ul class="CommonSidebarTagCloud">
<li class="CommonTag2"><a href="../../tags/Architecture/default.aspx.html" rel="tag">Architecture</a></li>
<li class="CommonTag6"><a href="../../tags/Audit/default.aspx.html" rel="tag">Audit</a></li>
<li class="CommonTag6"><a href="../../tags/Concurrency/default.aspx.html" rel="tag">Concurrency</a></li>
<li class="CommonTag6"><a href="../../tags/Configuration/default.aspx.html" rel="tag">Configuration</a></li>
<li class="CommonTag6"><a href="../../tags/convention+over+configuration/default.aspx.html" rel="tag">convention over configuration</a></li>
<li class="CommonTag6"><a href="../../tags/Conversation/default.aspx.html" rel="tag">Conversation</a></li>
<li class="CommonTag6"><a href="../../tags/entity+name/default.aspx.html" rel="tag">entity name</a></li>
<li class="CommonTag3"><a href="../../tags/events/default.aspx.html" rel="tag">events</a></li>
<li class="CommonTag6"><a href="../../tags/Filters/default.aspx.html" rel="tag">Filters</a></li>
<li class="CommonTag2"><a href="../../tags/FluentNH/default.aspx.html" rel="tag">FluentNH</a></li>
<li class="CommonTag6"><a href="../../tags/IIdentifierGenerator/default.aspx.html" rel="tag">IIdentifierGenerator</a></li>
<li class="CommonTag6"><a href="../../tags/Interceptor/default.aspx.html" rel="tag">Interceptor</a></li>
<li class="CommonTag6"><a href="../../tags/IoC+container/default.aspx.html" rel="tag">IoC container</a></li>
<li class="CommonTag2"><a href="../../tags/IUserType/default.aspx.html" rel="tag">IUserType</a></li>
<li class="CommonTag3"><a href="../../tags/lazy+loading/default.aspx.html" rel="tag">lazy loading</a></li>
<li class="CommonTag6"><a href="../../tags/listener/default.aspx.html" rel="tag">listener</a></li>
<li class="CommonTag6"><a href="../../tags/log/default.aspx.html" rel="tag">log</a></li>
<li class="CommonTag6"><a href="../../tags/logging/default.aspx.html" rel="tag">logging</a></li>
<li class="CommonTag1"><a href="../../tags/Mapping/default.aspx.html" rel="tag">Mapping</a></li>
<li class="CommonTag6"><a href="../../tags/Mapping+by+code/default.aspx.html" rel="tag">Mapping by code</a></li>
<li class="CommonTag1"><a href="../../tags/Nhibernate/default.aspx.html" rel="tag">Nhibernate</a></li>
<li class="CommonTag6"><a href="../../tags/Nhibernate+Documentation/default.aspx.html" rel="tag">Nhibernate Documentation</a></li>
<li class="CommonTag3"><a href="../../tags/property/default.aspx.html" rel="tag">property</a></li>
<li class="CommonTag2"><a href="../../tags/query/default.aspx.html" rel="tag">query</a></li>
<li class="CommonTag1"><a href="../../tags/Session/default.aspx.html" rel="tag">Session</a></li>
</ul>

				        </div>
				        <div class="CommonContentBoxFooter"><a href="../../tags/default.aspx.html">View more</a></div>
			        </div>
	            
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Page Details</h4>
	                    <div class="CommonContentBoxContent">
	            <div class="CustomWikiPageDetailsArea"><div class="CustomWikiPageDetailsTitle">First published by:</div><div class="CustomWikiPageDetailsAvatar"><img src="../../../../resized-image.ashx/__size/50x50/key/CommunityServer.Components.Avatars/00.00.00.21.34/4TA9FMIYGIH8.jpg" alt="" style="border-width:0px;" /></div><div class="CustomWikiPageDetailsContent"><a href="../../../../members/gabriel.schenker/default.aspx.html">gabriel.schenker</a><br/> on 09-06-2008</div></div><div class="CustomWikiPageDetailsArea"><div class="CustomWikiPageDetailsTitle">Last revision by:</div><div class="CustomWikiPageDetailsAvatar"><img src="../../../../utility/anonymous.gif" alt="" style="border-width:0px;max-height:50px;max-width:50px;" /></div><div class="CustomWikiPageDetailsContent"><a href="../../../../members/MarkCranness/default.aspx.html">MarkCranness</a><br/> on 07-08-2011</div></div><div class="WikiPageDetailsSummaryArea"><strong>5</strong> people found this article useful.</div>
				        </div>
				        
			        </div>
	            
	    
	    
	    
    </div>
    

			    </div>
                <div id="CommonSidebarLeft">
				    
				</div>
			    <div id="CommonContent"><div id="CommonContentInner">
    



<div class="CommonContentBox">
    <div class="CommonContentBoxContent">
        <div style="float: right">
            
        </div>
        
        <div class="CommonPaneTabSet">
            <div style="overflow: hidden; width: 100%;">
                <table border="0" cellpadding="0" cellspacing="0">
                <tbody>
                    <tr>
                        <td>
                            <div class="CommonPaneTab">
                                <a href="../../lazy-loading-eager-loading.aspx.html"><img align="absmiddle" border="0" src="../../../../Themes/hawaii/images/wiki/wiki-icon-article-tab.png" alt="" style="border-width:0px;" /></a>                            
                                <a href="../../lazy-loading-eager-loading.aspx.html">Article</a>
                            </div>
                        </td>
                        <td>
                            
                                    <div class="CommonPaneTab">
                                    
                                    
                                    </div>
                                
                        </td>
                        <td>
                            <div class="CommonPaneTab">
                                <a href="../comments.aspx.html"><img align="absmiddle" border="0" src="../../../../Themes/hawaii/images/wiki/wiki-icon-comment-tab.png" alt="" style="border-width:0px;" /></a>
                                <a href="../comments.aspx.html">Comments</a> (11)
                            </div>
                        </td>
                        <td>
                            <div class="CommonPaneTabSelected">
                                <a href="../history.aspx.html"><img align="absmiddle" border="0" src="../../../../Themes/hawaii/images/wiki/wiki-icon-history-tab.png" alt="" style="border-width:0px;" /></a>
                                <a href="../history.aspx.html">History</a> (8)
                            </div>
                        </td>
                    </tr>
                </tbody>
                </table>
            </div>
        </div>

        <div class="CommonPane">
            <div class="CommonGroupedContentArea">
                <h2 class="CommonContentBoxHeaderSmall"><span><a href="../../lazy-loading-eager-loading.aspx.html">Lazy loading - eager loading</a></span></h2>
                <div><p><a href="http://nhforge.org/cfs-file_ashx/key/CommunityServer.Blogs.Components.WeblogFiles/nhibernate/Blog-Signature-Gabriel_5F00_4.png"><img style="border-right:0px;border-top:0px;border-left:0px;border-bottom:0px;" alt="Blog Signature Gabriel" src="http://nhforge.org/cfs-file_ashx/key/CommunityServer.Blogs.Components.WeblogFiles/nhibernate/Blog-Signature-Gabriel_5F00_thumb_5F00_1.png" width="244" border="0" height="21" /></a> </p>
<p>In this article I want to discuss the <a href="http://martinfowler.com/eaaCatalog/lazyLoad.html">lazy loading</a> mechanism provided by NHibernate. It is recommended for maximum flexibility to define all relations in your domain as lazy loadable. This is the default behavior of NHibernate since version 1.2. But this can lead to some undesired effects if querying your data. Let&#39;s discuss these effects and how to avoid them.</p>
<p>In my previous posts I showed <a href="http://blogs.hibernatingrhinos.com/nhibernate/archive/2008/03/31/prepare-your-system-for-nhibernate.aspx">how to prepare your system for NHibernate</a> and <a href="../../your-first-nhibernate-based-application.aspx.html">how to implement a first NHibernate base application</a>. This post is based on those two articles.</p>
<h2>The Domain</h2>
<p>Let&#39;s first define a simple domain. It shows part of an order entry system. I keep this model as simple as possible (a real domain model would be more complex) but it contains all aspects we want to discuss in this post. Below is the class diagram of our model</p>
<p><a href="http://nhforge.org/cfs-file_ashx/key/CommunityServer.Blogs.Components.WeblogFiles/nhibernate/image_5F00_4.png"><img style="border-top-width:0px;border-left-width:0px;border-bottom-width:0px;border-right-width:0px;" alt="image" src="http://nhforge.org/cfs-file_ashx/key/CommunityServer.Blogs.Components.WeblogFiles/nhibernate/image_5F00_thumb_5F00_1.png" width="480" border="0" height="389" /></a> </p>
<p>We have an order entity which can be placed by a customer entity. Each order can have many order line entities. Each of the three entity types is uniquely identified by a property Id (surrogate key).</p>
<h2>The Mapping Files</h2>
<p>We have to write one mapping file per entity. It is recommended that you always have one mapping per file. Don&#39;t forget to set the <b>Build Action</b> of each mapping file to <b>Embedded Resource</b>. People often tend to forget it and the subsequent errors raised by NHibernate are not always obvious. Also do not forget to give the mapping files the correct name, that is *.<b>hbm</b>.xml where * denotes the placeholder for the entity name.</p>
<p>The mapping for the <b>Order</b> entity might be implemented as follows</p>
<div class="csharpcode">
<pre class="alt"><span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">=&quot;1.0&quot;</span> <span class="attr">encoding</span><span class="kwrd">=&quot;utf-8&quot;</span> ?<span class="kwrd">&gt;</span></pre>
<pre><span class="kwrd">&lt;</span><span class="html">hibernate-mapping</span> <span class="attr">xmlns</span><span class="kwrd">=&quot;urn:nhibernate-mapping-2.2&quot;</span></pre>
<pre class="alt">                   <span class="attr">assembly</span><span class="kwrd">=&quot;LazyLoadEagerLoad&quot;</span></pre>
<pre>                   <span class="attr">namespace</span><span class="kwrd">=&quot;LazyLoadEagerLoad.Domain&quot;</span><span class="kwrd">&gt;</span></pre>
<pre class="alt">  </pre>
<pre>  <span class="kwrd">&lt;</span><span class="html">class</span> <span class="attr">name</span><span class="kwrd">=&quot;Order&quot;</span> <span class="attr">table</span><span class="kwrd">=&quot;Orders&quot;</span><span class="kwrd">&gt;</span></pre>
<pre class="alt">    <span class="kwrd">&lt;</span><span class="html">id</span> <span class="attr">name</span><span class="kwrd">=&quot;Id&quot;</span><span class="kwrd">&gt;</span></pre>
<pre>      <span class="kwrd">&lt;</span><span class="html">generator</span> <span class="attr">class</span><span class="kwrd">=&quot;guid&quot;</span><span class="kwrd">/&gt;</span></pre>
<pre class="alt">    <span class="kwrd">&lt;/</span><span class="html">id</span><span class="kwrd">&gt;</span></pre>
<pre>    <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">=&quot;OrderNumber&quot;</span><span class="kwrd">/&gt;</span></pre>
<pre class="alt">    <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">=&quot;OrderDate&quot;</span><span class="kwrd">/&gt;</span></pre>
<pre>    </pre>
<pre class="alt">    <span class="kwrd">&lt;</span><span class="html">many-to-one</span> <span class="attr">name</span><span class="kwrd">=&quot;Customer&quot;</span> <span class="kwrd">/&gt;</span></pre>
<pre>&nbsp;</pre>
<pre class="alt">    <span class="kwrd">&lt;</span><span class="html">set</span> <span class="attr">name</span><span class="kwrd">=&quot;OrderLines&quot;</span> <span class="attr">cascade</span><span class="kwrd">=&quot;all-delete-orphan&quot;</span> <span class="kwrd">&gt;</span></pre>
<pre>      <span class="kwrd">&lt;</span><span class="html">key</span> <span class="attr">column</span><span class="kwrd">=&quot;OrderId&quot;</span><span class="kwrd">/&gt;</span></pre>
<pre class="alt">      <span class="kwrd">&lt;</span><span class="html">one-to-many</span> <span class="attr">class</span><span class="kwrd">=&quot;OrderLine&quot;</span><span class="kwrd">/&gt;</span></pre>
<pre>    <span class="kwrd">&lt;/</span><span class="html">set</span><span class="kwrd">&gt;</span></pre>
<pre class="alt">    </pre>
<pre>  <span class="kwrd">&lt;/</span><span class="html">class</span><span class="kwrd">&gt;</span></pre>
<pre class="alt">  </pre>
<pre><span class="kwrd">&lt;/</span><span class="html">hibernate-mapping</span><span class="kwrd">&gt;</span></pre>
</div>
<p>
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
</p>
<p>Analogous you can implement the mappings for the <b>Customer</b> entity</p>
<div class="csharpcode">
<pre class="alt"><span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">=&quot;1.0&quot;</span> <span class="attr">encoding</span><span class="kwrd">=&quot;utf-8&quot;</span> ?<span class="kwrd">&gt;</span> </pre>
<pre><span class="kwrd">&lt;</span><span class="html">hibernate-mapping</span> <span class="attr">xmlns</span><span class="kwrd">=&quot;urn:nhibernate-mapping-2.2&quot;</span></pre>
<pre class="alt">                   <span class="attr">assembly</span><span class="kwrd">=&quot;LazyLoadEagerLoad&quot;</span></pre>
<pre>                   <span class="attr">namespace</span><span class="kwrd">=&quot;LazyLoadEagerLoad.Domain&quot;</span><span class="kwrd">&gt;</span></pre>
<pre class="alt">  </pre>
<pre>  <span class="kwrd">&lt;</span><span class="html">class</span> <span class="attr">name</span><span class="kwrd">=&quot;Customer&quot;</span><span class="kwrd">&gt;</span></pre>
<pre class="alt">    <span class="kwrd">&lt;</span><span class="html">id</span> <span class="attr">name</span><span class="kwrd">=&quot;Id&quot;</span><span class="kwrd">&gt;</span></pre>
<pre>      <span class="kwrd">&lt;</span><span class="html">generator</span> <span class="attr">class</span><span class="kwrd">=&quot;guid&quot;</span><span class="kwrd">/&gt;</span></pre>
<pre class="alt">    <span class="kwrd">&lt;/</span><span class="html">id</span><span class="kwrd">&gt;</span></pre>
<pre>    <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">=&quot;CompanyName&quot;</span><span class="kwrd">/&gt;</span></pre>
<pre class="alt">  <span class="kwrd">&lt;/</span><span class="html">class</span><span class="kwrd">&gt;</span></pre>
<pre>&nbsp;</pre>
<pre class="alt"><span class="kwrd">&lt;/</span><span class="html">hibernate-mapping</span><span class="kwrd">&gt;</span></pre>
</div>
<p>
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
</p>
<p>and finally the mapping for the <b>OrderLine</b> entity.</p>
<div class="csharpcode">
<pre class="alt"><span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">=&quot;1.0&quot;</span> <span class="attr">encoding</span><span class="kwrd">=&quot;utf-8&quot;</span> ?<span class="kwrd">&gt;</span> </pre>
<pre><span class="kwrd">&lt;</span><span class="html">hibernate-mapping</span> <span class="attr">xmlns</span><span class="kwrd">=&quot;urn:nhibernate-mapping-2.2&quot;</span></pre>
<pre class="alt">                   <span class="attr">assembly</span><span class="kwrd">=&quot;LazyLoadEagerLoad&quot;</span></pre>
<pre>                   <span class="attr">namespace</span><span class="kwrd">=&quot;LazyLoadEagerLoad.Domain&quot;</span><span class="kwrd">&gt;</span></pre>
<pre class="alt">&nbsp;</pre>
<pre>  <span class="kwrd">&lt;</span><span class="html">class</span> <span class="attr">name</span><span class="kwrd">=&quot;OrderLine&quot;</span><span class="kwrd">&gt;</span></pre>
<pre class="alt">    <span class="kwrd">&lt;</span><span class="html">id</span> <span class="attr">name</span><span class="kwrd">=&quot;Id&quot;</span><span class="kwrd">&gt;</span></pre>
<pre>      <span class="kwrd">&lt;</span><span class="html">generator</span> <span class="attr">class</span><span class="kwrd">=&quot;guid&quot;</span><span class="kwrd">/&gt;</span></pre>
<pre class="alt">    <span class="kwrd">&lt;/</span><span class="html">id</span><span class="kwrd">&gt;</span></pre>
<pre>    <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">=&quot;Amount&quot;</span><span class="kwrd">/&gt;</span></pre>
<pre class="alt">    <span class="kwrd">&lt;</span><span class="html">property</span> <span class="attr">name</span><span class="kwrd">=&quot;ProductName&quot;</span><span class="kwrd">/&gt;</span></pre>
<pre>  <span class="kwrd">&lt;/</span><span class="html">class</span><span class="kwrd">&gt;</span></pre>
<pre class="alt">  </pre>
<pre><span class="kwrd">&lt;/</span><span class="html">hibernate-mapping</span><span class="kwrd">&gt;</span></pre>
</div>
<p>
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
</p>
<p>&nbsp;</p>
<h2>Testing the Mapping</h2>
<p>To test the mapping we use the following test method</p>
<div class="csharpcode">
<pre class="alt"><span class="kwrd">using</span> LazyLoadEagerLoad.Domain;</pre>
<pre><span class="kwrd">using</span> NHibernate.Cfg;</pre>
<pre class="alt"><span class="kwrd">using</span> NHibernate.Tool.hbm2ddl;</pre>
<pre><span class="kwrd">using</span> NUnit.Framework;</pre>
<pre class="alt">&nbsp;</pre>
<pre><span class="kwrd">namespace</span> LazyLoadEagerLoad.Tests</pre>
<pre class="alt">{</pre>
<pre>    [TestFixture]</pre>
<pre class="alt">    <span class="kwrd">public</span> <span class="kwrd">class</span> GenerateSchema_Fixture</pre>
<pre>    {</pre>
<pre class="alt">        [Test]</pre>
<pre>        <span class="kwrd">public</span> <span class="kwrd">void</span> Can_generate_schema()</pre>
<pre class="alt">        {</pre>
<pre>            var cfg = <span class="kwrd">new</span> Configuration();</pre>
<pre class="alt">            cfg.Configure();</pre>
<pre>            cfg.AddAssembly(<span class="kwrd">typeof</span>(Order).Assembly);</pre>
<pre class="alt">&nbsp;</pre>
<pre>            <span class="kwrd">new</span> SchemaExport(cfg).Execute(<span class="kwrd">false</span>, <span class="kwrd">true</span>, <span class="kwrd">false</span>, <span class="kwrd">false</span>);</pre>
<pre class="alt">        }</pre>
<pre>    }</pre>
<pre class="alt">}</pre>
</div>
<p>
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
First we create a new instance of the NHibernate Configuration class and tell it to configure itself. Since we don&#39;t provide any explicit configuration here in the code NHibernate looks out for an adequate configuration file. I have included such a file (called hibernate.cfg.xml) in my project. Please consult <a href="http://blogs.hibernatingrhinos.com/nhibernate/archive/2008/04/01/your-first-nhibernate-based-application.aspx">this</a> previous post for further details about the configuration file. 
</p>
<h2>Testing the Loading Behavior of NHibernate</h2>
<h3>Defining a base class for our tests</h3>
<p>To avoid repetitive task (<a href="http://en.wikipedia.org/wiki/Don&#39;t_repeat_yourself">DRY</a> principle) we implement the following base class.</p>
<div class="csharpcode">
<pre class="alt"><span class="kwrd">using</span> LazyLoadEagerLoad.Domain;</pre>
<pre><span class="kwrd">using</span> NHibernate;</pre>
<pre class="alt"><span class="kwrd">using</span> NHibernate.Cfg;</pre>
<pre><span class="kwrd">using</span> NHibernate.Tool.hbm2ddl;</pre>
<pre class="alt"><span class="kwrd">using</span> NUnit.Framework;</pre>
<pre>&nbsp;</pre>
<pre class="alt"><span class="kwrd">namespace</span> LazyLoadEagerLoad.Tests</pre>
<pre>{</pre>
<pre class="alt">    <span class="kwrd">public</span> <span class="kwrd">class</span> TestFixtureBase</pre>
<pre>    {</pre>
<pre class="alt">        <span class="kwrd">private</span> Configuration _configuration;</pre>
<pre>        <span class="kwrd">private</span> ISessionFactory _sessionFactory;</pre>
<pre class="alt">&nbsp;</pre>
<pre>        <span class="kwrd">protected</span> ISessionFactory SessionFactory</pre>
<pre class="alt">        {</pre>
<pre>            get { <span class="kwrd">return</span> _sessionFactory; }</pre>
<pre class="alt">        }</pre>
<pre>&nbsp;</pre>
<pre class="alt">        [TestFixtureSetUp]</pre>
<pre>        <span class="kwrd">public</span> <span class="kwrd">void</span> TestFixtureSetUp()</pre>
<pre class="alt">        {</pre>
<pre>            _configuration = <span class="kwrd">new</span> Configuration();</pre>
<pre class="alt">            _configuration.Configure();</pre>
<pre>            _configuration.AddAssembly(<span class="kwrd">typeof</span>(Customer).Assembly);</pre>
<pre class="alt">            _sessionFactory = _configuration.BuildSessionFactory();</pre>
<pre>        }</pre>
<pre class="alt">&nbsp;</pre>
<pre>        [TestFixtureTearDown]</pre>
<pre class="alt">        <span class="kwrd">public</span> <span class="kwrd">void</span> TestFixtureTearDown()</pre>
<pre>        {</pre>
<pre class="alt">            _sessionFactory.Close();</pre>
<pre>        }</pre>
<pre class="alt">&nbsp;</pre>
<pre>        [SetUp]</pre>
<pre class="alt">        <span class="kwrd">public</span> <span class="kwrd">void</span> SetupContext()</pre>
<pre>        {</pre>
<pre class="alt">            <span class="kwrd">new</span> SchemaExport(_configuration).Execute(<span class="kwrd">false</span>, <span class="kwrd">true</span>, <span class="kwrd">false</span>, <span class="kwrd">false</span>);</pre>
<pre>            Before_each_test();</pre>
<pre class="alt">        }</pre>
<pre>&nbsp;</pre>
<pre class="alt">        [TearDown]</pre>
<pre>        <span class="kwrd">public</span> <span class="kwrd">void</span> TearDownContext()</pre>
<pre class="alt">        {</pre>
<pre>            After_each_test();</pre>
<pre class="alt">        }</pre>
<pre>&nbsp;</pre>
<pre class="alt">        <span class="kwrd">protected</span> <span class="kwrd">virtual</span> <span class="kwrd">void</span> Before_each_test()</pre>
<pre>        { }</pre>
<pre class="alt">&nbsp;</pre>
<pre>        <span class="kwrd">protected</span> <span class="kwrd">virtual</span> <span class="kwrd">void</span> After_each_test()</pre>
<pre class="alt">        { }</pre>
<pre>    }</pre>
<pre class="alt">}</pre>
</div>
<p>When the test fixture is started, the base class configures NHibernate and creates a session factory (<b>TestFixtureSetUp</b>). When the whole test fixture is ended the session factory is closed (<b>TestFixtureTearDown</b>).</p>
<p>Before each test in the fixture is run the database schema is (re-) created and the virtual <b>Before_each_test</b> method is called. After each test in the fixture is finished the virtual <b>After_each_test</b> method is called. The two virtual methods can (but must not necessarily) be overridden in a child class.
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
</p>
<p>All our test fixtures we implement will derive from this base class.</p>
<h3>Filling the database with test data</h3>
<p>To be able to test the loading behavior of NHibernate we need some test data in our database. We create this test data every time a test is run (just after the database schema is re-created). We add a new class <b>Order_Fixture</b> to our test project and inherit from the <b>TestFixtureBase</b> base class. Then we override the Before_each_test method and call a helper method which creates our initial data. We create just the absolute minimum of data we need (again --&gt;DRY). That is: one customer placing one order with two order lines.</p>
<div class="csharpcode">
<pre class="alt"><span class="kwrd">using</span> System;</pre>
<pre><span class="kwrd">using</span> LazyLoadEagerLoad.Domain;</pre>
<pre class="alt"><span class="kwrd">using</span> NHibernate;</pre>
<pre><span class="kwrd">using</span> NHibernate.Criterion;</pre>
<pre class="alt"><span class="kwrd">using</span> NHibernate.SqlCommand;</pre>
<pre><span class="kwrd">using</span> NUnit.Framework;</pre>
<pre class="alt"><span class="kwrd">using</span> Order=LazyLoadEagerLoad.Domain.Order;</pre>
<pre>&nbsp;</pre>
<pre class="alt"><span class="kwrd">namespace</span> LazyLoadEagerLoad.Tests</pre>
<pre>{</pre>
<pre class="alt">    [TestFixture]</pre>
<pre>    <span class="kwrd">public</span> <span class="kwrd">class</span> Order_Fixture : TestFixtureBase</pre>
<pre class="alt">    {</pre>
<pre>        <span class="kwrd">private</span> Order _order;</pre>
<pre class="alt">&nbsp;</pre>
<pre>        <span class="kwrd">protected</span> <span class="kwrd">override</span> <span class="kwrd">void</span> Before_each_test()</pre>
<pre class="alt">        {</pre>
<pre>            <span class="kwrd">base</span>.Before_each_test();</pre>
<pre class="alt">            CreateInitialData();</pre>
<pre>        }</pre>
<pre class="alt">&nbsp;</pre>
<pre>        <span class="kwrd">private</span> <span class="kwrd">void</span> CreateInitialData()</pre>
<pre class="alt">        {</pre>
<pre>            <span class="rem">// create a single customer and an order with two order lines for this customer</span></pre>
<pre class="alt">            var customer = <span class="kwrd">new</span> Customer {CompanyName = <span class="str">&quot;IBM&quot;</span>};</pre>
<pre>            var line1 = <span class="kwrd">new</span> OrderLine {Amount = 5, ProductName = <span class="str">&quot;Laptop XYZ&quot;</span>};</pre>
<pre class="alt">            var line2 = <span class="kwrd">new</span> OrderLine {Amount = 2, ProductName = <span class="str">&quot;Desktop PC A100&quot;</span>};</pre>
<pre>            _order = <span class="kwrd">new</span> Order</pre>
<pre class="alt">                        {</pre>
<pre>                            OrderNumber = <span class="str">&quot;o-100-001&quot;</span>,</pre>
<pre class="alt">                            OrderDate = DateTime.Today,</pre>
<pre>                            Customer = customer</pre>
<pre class="alt">                        };</pre>
<pre>            _order.OrderLines.Add(line1);</pre>
<pre class="alt">            _order.OrderLines.Add(line2);</pre>
<pre>&nbsp;</pre>
<pre class="alt">            <span class="kwrd">using</span> (ISession session = SessionFactory.OpenSession())</pre>
<pre>                <span class="kwrd">using</span> (ITransaction transaction = session.BeginTransaction())</pre>
<pre class="alt">                {</pre>
<pre>                    session.Save(customer);</pre>
<pre class="alt">                    session.Save(_order);</pre>
<pre>                    transaction.Commit();</pre>
<pre class="alt">                }</pre>
<pre>        }</pre>
<pre class="alt">    }</pre>
<pre>}</pre>
</div>
<p>
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
</p>
<p>The <b>CreateInitialData</b> method is run before each test. With this we guarantee that each test is side effects free.</p>
<h3>Verifying the default behavior - Lazy Loading</h3>
<p>When loading an order entity from database the default behavior of NHibernate is to lazy load all associated objects of the order entity. Let&#39;s write a test to verify this. For the verification we use a utility class provided by NHibernate (NHibernateUtil) which can test whether an associated object or object collection is initialized (i.e. loaded) or not. The class can also force the initialization of an un-initialized relation.</p>
<div class="csharpcode">
<pre class="alt">[Test]</pre>
<pre><span class="kwrd">public</span> <span class="kwrd">void</span> Customer_and_OrderLines_are_not_loaded_when_loading_Order()</pre>
<pre class="alt">{</pre>
<pre>    Order fromDb;</pre>
<pre class="alt">    <span class="kwrd">using</span> (ISession session = SessionFactory.OpenSession())</pre>
<pre>        fromDb = session.Get&lt;Order&gt;(_order.Id);</pre>
<pre class="alt">&nbsp;</pre>
<pre>    Assert.IsFalse(NHibernateUtil.IsInitialized(fromDb.Customer));</pre>
<pre class="alt">    Assert.IsFalse(NHibernateUtil.IsInitialized(fromDb.OrderLines));</pre>
<pre>}</pre>
</div>
<p>
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
</p>
<p>The test succeeds and NHibernate generates SQL similar to this one</p>
<div class="csharpcode">
<pre class="alt"><span class="kwrd">SELECT</span>    order0_.Id <span class="kwrd">as</span> Id0_0_, </pre>
<pre>    order0_.OrderNumber <span class="kwrd">as</span> OrderNum2_0_0_, </pre>
<pre class="alt">    order0_.OrderDate <span class="kwrd">as</span> OrderDate0_0_, </pre>
<pre>    order0_.CustomerId <span class="kwrd">as</span> CustomerId0_0_ </pre>
<pre class="alt"><span class="kwrd">FROM</span>    Orders order0_ </pre>
<pre><span class="kwrd">WHERE</span>    order0_.Id=<span class="str">&#39;15bca5b3-2771-4bee-9923-85bda66318d8&#39;</span></pre>
</div>
<p>
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
</p>
<p>&nbsp;</p>
<p>Now we have a problem: If we want to access the order line items (after the session has been closed) we get an exception. Since the session is closed NHibernate cannot lazily load the order line items for us. We can show this behavior with the following test method</p>
<div class="csharpcode">
<pre class="alt">[Test]</pre>
<pre>[ExpectedException(<span class="kwrd">typeof</span>(LazyInitializationException))]</pre>
<pre class="alt"><span class="kwrd">public</span> <span class="kwrd">void</span> Accessing_customer_of_order_after_session_is_closed_throws()</pre>
<pre>{</pre>
<pre class="alt">    Order fromDb;</pre>
<pre>    <span class="kwrd">using</span> (ISession session = SessionFactory.OpenSession())</pre>
<pre class="alt">        fromDb = session.Get&lt;Order&gt;(_order.Id);</pre>
<pre>    </pre>
<pre class="alt">    <span class="rem">// trying to access the Customer of the order, will throw exception</span></pre>
<pre>    <span class="rem">// Note: at this point the session is already closed</span></pre>
<pre class="alt">    <span class="kwrd">string</span> name = fromDb.Customer.CompanyName;</pre>
<pre>}</pre>
</div>
<p>Note: the above test <b>only</b> succeeds if the method throws the expected exception of type <b>LazyInitializationException</b>. And this is just what we want to show!
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
</p>
<p>Another problem is the <b>n+1 select statements problem</b>. If we access the order line items after loading the order we generate a select statement for each line item we access. Thus if we have n line items and want to access them all we generate one select statement for the order itself and n select statements for all line items (result: n+1 select statements). This can make our data fetching rather slow and put a (unnecessary) burden onto our database.</p>
<p>We can simulate this behavior with this test method</p>
<div class="csharpcode">
<pre class="alt">[Test]</pre>
<pre><span class="kwrd">public</span> <span class="kwrd">void</span> Show_n_plus_1_select_behavior()</pre>
<pre class="alt">{</pre>
<pre>    <span class="kwrd">using</span> (ISession session = SessionFactory.OpenSession())</pre>
<pre class="alt">    {</pre>
<pre>        var fromDb = session.Get&lt;Order&gt;(_order.Id);</pre>
<pre class="alt">        <span class="kwrd">int</span> sum = 0;</pre>
<pre>        <span class="kwrd">foreach</span> (var line <span class="kwrd">in</span> fromDb.OrderLines)</pre>
<pre class="alt">        {</pre>
<pre>            <span class="rem">// just some dummy code to force loading of order line</span></pre>
<pre class="alt">            sum += line.Amount;</pre>
<pre>        } </pre>
<pre class="alt">    }</pre>
<pre>}</pre>
</div>
<p>NHibernate will generate SQL similar to the following
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
</p>
<div class="csharpcode">
<pre class="alt">SELECT order0_.Id <span class="kwrd">as</span> Id3_0_, </pre>
<pre>       order0_.OrderNumber <span class="kwrd">as</span> OrderNum2_3_0_, </pre>
<pre class="alt">       order0_.OrderDate <span class="kwrd">as</span> OrderDate3_0_, </pre>
<pre>       order0_.Customer <span class="kwrd">as</span> Customer3_0_ </pre>
<pre class="alt">FROM   Orders order0_ </pre>
<pre>WHERE  order0_.Id=<span class="str">&#39;5b2dbcb7-d0bf-4c53-86aa-8cd40cb5061a&#39;</span></pre>
<pre class="alt">&nbsp;</pre>
<pre>SELECT orderlines0_.OrderId <span class="kwrd">as</span> OrderId1_, </pre>
<pre class="alt">       orderlines0_.Id <span class="kwrd">as</span> Id1_, </pre>
<pre>       orderlines0_.Id <span class="kwrd">as</span> Id4_0_, </pre>
<pre class="alt">       orderlines0_.Amount <span class="kwrd">as</span> Amount4_0_, </pre>
<pre>       orderlines0_.ProductName <span class="kwrd">as</span> ProductN3_4_0_ </pre>
<pre class="alt">FROM   OrderLine orderlines0_ </pre>
<pre>WHERE  orderlines0_.OrderId=<span class="str">&#39;5b2dbcb7-d0bf-4c53-86aa-8cd40cb5061a&#39;</span></pre>
</div>
<p>
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
</p>
<p>This time we have been lucky! NHibernate has automatically generated an optimized query for us and has loaded the 2 order line items in one go. But this is not always the case! Imagine having a collection with several 100 items and you only need to access one or two of them. It would be a waste of resources to always load all items.</p>
<p>But fortunately we have a solution for these kind of problems with NHibernate. It&#39;s called eagerly loading.</p>
<h3>Eagerly loading with the NHibernateUtil class</h3>
<p>If you know you need have access to related objects of the order entity you can use the <b>NHibernateUtil</b> class to initialize the related objects (that is: to fetch them from the database). Have a look at this test methods</p>
<div class="csharpcode">
<pre class="alt">[Test]</pre>
<pre><span class="kwrd">public</span> <span class="kwrd">void</span> Can_initialize_customer_of_order_with_nhibernate_util()</pre>
<pre class="alt">{</pre>
<pre>    Order fromDb;</pre>
<pre class="alt">    <span class="kwrd">using</span> (ISession session = SessionFactory.OpenSession())</pre>
<pre>    {</pre>
<pre class="alt">        fromDb = session.Get&lt;Order&gt;(_order.Id);</pre>
<pre>        NHibernateUtil.Initialize(fromDb.Customer);</pre>
<pre class="alt">    }</pre>
<pre>&nbsp;</pre>
<pre class="alt">    Assert.IsTrue(NHibernateUtil.IsInitialized(fromDb.Customer));</pre>
<pre>    Assert.IsFalse(NHibernateUtil.IsInitialized(fromDb.OrderLines));</pre>
<pre class="alt">}</pre>
<pre>&nbsp;</pre>
<pre class="alt">[Test]</pre>
<pre><span class="kwrd">public</span> <span class="kwrd">void</span> Can_initialize_order_lines_of_order_with_nhibernate_util()</pre>
<pre class="alt">{</pre>
<pre>    Order fromDb;</pre>
<pre class="alt">    <span class="kwrd">using</span> (ISession session = SessionFactory.OpenSession())</pre>
<pre>    {</pre>
<pre class="alt">        fromDb = session.Get&lt;Order&gt;(_order.Id);</pre>
<pre>        NHibernateUtil.Initialize(fromDb.OrderLines);</pre>
<pre class="alt">    }</pre>
<pre>&nbsp;</pre>
<pre class="alt">    Assert.IsFalse(NHibernateUtil.IsInitialized(fromDb.Customer));</pre>
<pre>    Assert.IsTrue(NHibernateUtil.IsInitialized(fromDb.OrderLines));</pre>
<pre class="alt">}</pre>
</div>
<p>
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
</p>
<p>With this utility class you can initialize single objects as well as collection of objects. In each case NHibernate will send 2 select statements to the database. One to select the order and one to initialize the related object(s).</p>
<h3>Eagerly loading with HQL</h3>
<p>If you know that you want to load all order items of a given order then you can tell NHibernate to do so and eagerly load all order lines together with the order in one go. The following test method shows how you can formulate a HQL query which not only loads the order but also the associated customer and order lines.</p>
<div class="csharpcode">
<pre class="alt">[Test]</pre>
<pre><span class="kwrd">public</span> <span class="kwrd">void</span> Can_eagerly_load_order_aggregate_with_hql_query()</pre>
<pre class="alt">{</pre>
<pre>    Order fromDb;</pre>
<pre class="alt">    <span class="kwrd">using</span> (ISession session = SessionFactory.OpenSession())</pre>
<pre>    {</pre>
<pre class="alt">        <span class="kwrd">string</span> sql = <span class="str">&quot;from Order o&quot;</span> +</pre>
<pre>                     <span class="str">&quot; inner join fetch o.OrderLines&quot;</span> +</pre>
<pre class="alt">                     <span class="str">&quot; inner join fetch o.Customer&quot;</span> +</pre>
<pre>                     <span class="str">&quot; where o.Id=:id&quot;</span>;</pre>
<pre class="alt">        fromDb = session.CreateQuery(sql)</pre>
<pre>                        .SetGuid(<span class="str">&quot;id&quot;</span>, _order.Id)</pre>
<pre class="alt">                        .UniqueResult&lt;Order&gt;();</pre>
<pre>    }</pre>
<pre class="alt">    Assert.IsTrue(NHibernateUtil.IsInitialized(fromDb.Customer));</pre>
<pre>    Assert.IsTrue(NHibernateUtil.IsInitialized(fromDb.OrderLines));</pre>
<pre class="alt">}</pre>
</div>
<p>
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
</p>
<p>The resulting sql generated by NHibernate is then similar to this one</p>
<pre class="csharpcode"><span class="kwrd">select</span>      order0_.Id <span class="kwrd">as</span> Id0_0_, <br />            orderlines1_.Id <span class="kwrd">as</span> Id1_1_, <br />            customer2_.Id <span class="kwrd">as</span> Id2_2_, <br />            order0_.OrderNumber <span class="kwrd">as</span> OrderNum2_0_0_, <br />            order0_.OrderDate <span class="kwrd">as</span> OrderDate0_0_, <br />            order0_.CustomerId <span class="kwrd">as</span> CustomerId0_0_, <br />            orderlines1_.Amount <span class="kwrd">as</span> Amount1_1_, <br />            orderlines1_.ProductName <span class="kwrd">as</span> ProductN3_1_1_, <br />            customer2_.CompanyName <span class="kwrd">as</span> CompanyN2_2_2_, <br />            orderlines1_.OrderId <span class="kwrd">as</span> OrderId0__, <br />            orderlines1_.Id <span class="kwrd">as</span> Id0__ <br /><span class="kwrd">from</span>        Orders order0_ <br /><span class="kwrd">inner</span> <span class="kwrd">join</span>  OrderLine orderlines1_ <span class="kwrd">on</span> order0_.Id=orderlines1_.OrderId <br /><span class="kwrd">inner</span> <span class="kwrd">join</span>  Customer customer2_ <span class="kwrd">on</span> order0_.CustomerId=customer2_.Id <br /><span class="kwrd">where</span>       order0_.Id=<span class="str">&#39;409ebd99-3206-459b-bfed-6df989284da9&#39;</span></pre>
<p>
&lt;style type=&quot;text/css&quot;&gt;&lt;!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, &quot;Courier New&quot;, courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--&gt;&lt;/style&gt;
</p>
<p>NHibernate has created an SQL select statement which joins the 3 tables involved, namely <b>Orders</b>, <b>Customer</b> and <b>OrderLine</b>. The returned (flat) set of records is then used by NHibernate to build up the object tree with the order entity as a root.</p>
<h2>Aggregates in the Domain</h2>
<p>DDD defines the concept of <a href="http://domaindrivendesign.org/discussion/messageboardarchive/Aggregates.html">aggregates</a>. A short definition of an aggregate is &quot;<i>A cluster of associated objects that are treated as a unit for the purpose of data changes.&quot;. </i>An aggregate always has a <i>root</i>.<i>&nbsp;</i>In this context we can define the following aggregate in our domain</p>
<p><a href="http://nhforge.org/cfs-file_ashx/key/CommunityServer.Blogs.Components.WeblogFiles/nhibernate/image_5F00_8.png"><img style="border-top-width:0px;border-left-width:0px;border-bottom-width:0px;border-right-width:0px;" alt="image" src="http://nhforge.org/cfs-file_ashx/key/CommunityServer.Blogs.Components.WeblogFiles/nhibernate/image_5F00_thumb_5F00_3.png" width="575" border="0" height="445" /></a> </p>
<p>The order entity is the <i>root</i> and the order lines belong to the aggregate (can be regarded as children of the <i>root</i>). When creating a new order or changing an existing one we only want to modify either the order itself or its order lines. We certainly do not want to change the customer entity because this would be a completely different use case and does not belong to the <i>order management</i> use case.</p>
<p>So, when dealing with aggregates we often want to load the complete aggregate in one go! This is the perfect example for using <b>eager loading</b> techniques.</p>
<h2>Summary</h2>
<p>I have introduced the concept of lazy loading as provided by NHibernate. I have discussed the consequences and shown how to avoid negative side effects by using different techniques of so called eager loading.</p>
<p><a href="http://nhforge.org/cfs-file_ashx/key/CommunityServer.Blogs.Components.WeblogFiles/nhibernate/Blog-Signature-Gabriel_5F00_2.png"><img style="border-top-width:0px;border-left-width:0px;border-bottom-width:0px;border-right-width:0px;" alt="Blog Signature Gabriel" src="http://nhforge.org/cfs-file_ashx/key/CommunityServer.Blogs.Components.WeblogFiles/nhibernate/Blog-Signature-Gabriel_5F00_thumb.png" width="244" border="0" height="21" /></a></p></div>
            </div>
        </div>

    </div>
</div>


</div></div>
			    <div style="clear: both;"></div>
			    
			    
            </div>
                
            <div id="CommonFooter">
                <div class="Common">
                    
                        
                	    
                        

                        
                                <a href="http://communityserver.com/" target="_blank"><img src="../../../../utility/PoweredByCS_commercial.gif" alt="Powered by Community Server (Commercial Edition), by Telligent Systems " style="border-width:0px;" /></a>
		                    
                		
                    
                 </div>
            </div>
		
<script type="text/javascript">
// <![CDATA[
Telligent_Modal.Configure('/utility/loading.htm',['CommonModal'],['CommonModalTitle'],['CommonModalClose'],['CommonModalContent'],['CommonModalFooter'],['CommonModalResize'],['CommonModalMask'],100,false,true);
// ]]>
</script><script type="text/javascript">
<!--
function KeyDownHandlerctl00_ctl00_sr_sr_ctl00_ctl00_TitleBarSearchButton(event)
{
	if (event.keyCode == 13)
	{
		event.returnValue = false;
		event.cancel = true;
     __doPostBack('ctl00$ctl00$sr$sr$ctl00$ctl00$TitleBarSearchButton','')
   return false;
	}
}

//-->
</script>
<script type="text/javascript">
// <![CDATA[
window.ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01=new WikiPageHierarchy('ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01',new Function('mode','pageId','callback','WebForm_DoCallback(\'ctl00$ctl00$rcr$rcr$ctl00$ctl02$ctl00$ctl01$ctl01\',mode + \':\' + pageId,callback,\"\",null,false)'),'<img src="http://nhforge.org/wikis/howtonh/lazy-loading-eager-loading/revision/\&quot;/WebResource.axd?d=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000\&quot;" alt=\"+\" style=\"border-width: 0;\" />','<img src="http://nhforge.org/wikis/howtonh/lazy-loading-eager-loading/revision/\&quot;/WebResource.axd?d=I7Z2L5Ca7ffItUeObf-LA3ykZ3Mbmr-vwfNJv2PfNk2O4alHWIJbJADyKhl0k71mJCpGTePjifKqZQx_Rs64LrGhlEU25qRjlCh8LoYwo2tck8EIbBdQKg5CISopk9hz_6ZbK_GNtBJljwOq57_FBvxYCTM1&amp;t=634395149500000000\&quot;" alt=\"-\" style=\"border-width: 0;\" />','<div>Loading...</div>');
// ]]>
</script><script type="text/javascript">
// <![CDATA[
window.ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01=new WikiPageHierarchy('ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01',new Function('mode','pageId','callback','WebForm_DoCallback(\'ctl00$ctl00$rcr$rcr$ctl00$ctl03$ctl00$ctl01$ctl01\',mode + \':\' + pageId,callback,\"\",null,false)'),'<img src="http://nhforge.org/wikis/howtonh/lazy-loading-eager-loading/revision/\&quot;/WebResource.axd?d=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000\&quot;" alt=\"+\" style=\"border-width: 0;\" />','<img src="http://nhforge.org/wikis/howtonh/lazy-loading-eager-loading/revision/\&quot;/WebResource.axd?d=I7Z2L5Ca7ffItUeObf-LA3ykZ3Mbmr-vwfNJv2PfNk2O4alHWIJbJADyKhl0k71mJCpGTePjifKqZQx_Rs64LrGhlEU25qRjlCh8LoYwo2tck8EIbBdQKg5CISopk9hz_6ZbK_GNtBJljwOq57_FBvxYCTM1&amp;t=634395149500000000\&quot;" alt=\"-\" style=\"border-width: 0;\" />','<div>Loading...</div>');
// ]]>
</script><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5443308-1");
pageTracker._trackPageview();
</script></form>
		
	</body>
</html>
