

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head><meta http-equiv="X-UA-Compatible" content="IE=7" /><meta name="robots" content="index,follow" />
<meta name="description" content="The official NHibernate community site. Download NHibernate. Read blogs. Contribute to the NHibernate Wiki. Find reference documentation." />
<meta name="keywords" content="NHibernate, NHibernate Contrib, community, Burrow, Downloads" />
<meta name="GENERATOR" content="CommunityServer 2008.5 SP1 (Build: 31106.3070)" />
<link rel="shortcut icon" type="image/ico" href="../../../../favicon.ico" />
<link rel="alternate" type="application/rss+xml" title="Changing Values in NHibernate Events (RSS 2.0)" href="../rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="How to (RSS 2.0)" href="http://nhforge.org/wikis/howtonh/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="Scott Findlater&#39;s Announcements (RSS 2.0)" href="../../../../members/Scott-Findlater/announcements/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="Scott Findlater&#39;s Comments (RSS 2.0)" href="../../../../members/Scott-Findlater/comments/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="Scott Findlater&#39;s Activities (RSS 2.0)" href="../../../../members/Scott-Findlater/activities/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="Scott Findlater&#39;s Friends Activity (RSS 2.0)" href="../../../../members/Scott-Findlater/activities/friendrss.aspx"  />

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <style type="text/css"> body { font-size: 84%; } </style>
        <link rel="stylesheet" href="../../../../themes/hawaii/style/Common.css" type="text/css" media="screen,print" />
        <link rel="stylesheet" href="../../../../themes/hawaii/style/common_print.css" type="text/css" media="print" />
        
    
    <link rel="stylesheet" href="../../../../Themes/hawaii/style/wiki.css" type="text/css" media="screen,print" />
	

        <link rel="stylesheet" href="../../../../themes/hawaii/style/DynamicStyle.aspx.css" type="text/css" media="screen" />
        <!--[if lte IE 6]>
            <link rel="stylesheet" href="/themes/hawaii/style/ie6.css" type="text/css" media="screen" />
        <![endif]-->
    <meta name="google-site-verification" content="u9qihpHbzSFdf2ypCUvCQrj9IJkANGzorC8zMk0859M" />
<title>
	NHibernate, Audit trails and OnPreInsert/ OnPreUpdate event listeners vs Save/ Update event listeners: Revision #8 - NHibernate Forge
</title></head>
	<body>
		<form name="aspnetForm" method="post" action="8.aspx.html" id="aspnetForm">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTE2ODYxODYyODBkGAEFHl9fQ29udHJvbHNSZXF1aXJlUG9zdEJhY2tLZXlfXxYBBTBjdGwwMCRjdGwwMCRzciRzciRjdGwwMCRjdGwwMCRUaXRsZUJhclNlYXJjaFRleHRS2dku67jB2SYXikwjMUBFR1YWDw==" />
</div>


<script src="../../../../WebResource.axd%3Fd=0gbcOAOlbWsHyCtP1tLKZQbpxrEkhg31E8L04T1x-hMLrsMonvmUNQvxBohSywWHueFgWT841lW9e5k7Gp2DbPsOLeN3Sv3SB7czfVSlQGxYOHnJcLlKfh3v9vlcjJ9ggvps0fjahw73J3SVYQmGvS0rXng1&amp;t=634395149500000000" type="text/javascript"></script>
<script src="../../../../WebResource.axd%3Fd=qXX_qxw7Y60qjc1NsxHnuIWUCy9JxjEUKLrY5KEQyuYhKzv3UmRPH805gTXU5edfSsLl7PHTIDuZbzGOp5UYEWeQ6anyqFa-m5TiNnZiD5MOrgiKWAZBgPyJ267gdCbk0_TpK2BaAhLvEgyM28dt9SYQ2UM1&amp;t=634395149500000000" type="text/javascript"></script>
<script src="../../../../WebResource.axd%3Fd=c5kkseX-7hUDg441H_iVoy5ws7YKvwS4KliHEKHuRl5UdJkUU5Jbdf2sxzCcbfyn6sqe17DzqhSTfAyV8nyJKMHhScl2IzjSz37RVYryN9Omis3K0NCj_OJ4fHZH3n9_IPBlNLVyYL45kjJL_zhydrkKTi3FfxaImDeS_1JZIO7o9iFs0&amp;t=634395149500000000" type="text/javascript"></script>
						

			

		    
		        <div id="CommonHeader">
		            <div class="Common">
		                <div id="CommonHeaderTitleArea">
		                    <table cellpadding="0" cellspacing="0" border="0"><tr valign="middle">
		                        <td><div style="margin-right: 10px;"><img src="../../../../cfs-file_ashx/__key/CommunityServer.Components.SiteFiles/logos/LogoNH.gif" alt="" style="border-width:0px;" /></div></td>
		                        <td>
		                            <div class="CommonHeaderTitle">NHibernate Forge</div>
		                            <div class="CommonHeaderTitleDescription">The official new home for the NHibernate for .NET community</div>
		                        </td>
		                    </tr></table>
		                </div>
		                <div id="CommonHeaderUserArea">
		                    <table cellpadding="0" cellspacing="0" border="0"><tr valign="top"><td>
                                <div id="CommonHeaderUserContent">
                                    <div id="CommonHeaderUserWelcome">
                                        
        <a href="../../../../login.aspx%3FReturnUrl=%252Fwikis%252Fhowtonh%252Fchanging-values-in-nhibernate-events%252Frevision%252F8.aspx.html">Sign in </a>
         | <a href="../../../../user/CreateUser.aspx%3FReturnUrl=.html">Join</a>
        | <a href="http://dev.communityserver.com/r.ashx?K&amp;siteurl=wikis.wiki_Page_ViewRevision">Help</a>
     


                                    </div>
                                </div>
                            </td></tr></table>
                        </div>
                    </div>
                </div>
                <div id="CommonNavigation">
                    <div class="Common"><div class="Inner">
                        <ul>
                                
                                <li><a href="../../../../index.html">Home</a></li>
                            
                                
                                <li><a href="../../../../blogs/nhibernate.html">Blog</a></li>
                            
                                <li><a class="Selected" href="../../../index.html">Wikis</a></li>
                                
                            
                                
                                <li><a href="../../../../groups/index.html">Groups</a></li>
                            
                                
                                <li><a href="../../../../doc/nh/en/index.html">Reference</a></li>
                            
                                
                                <li><a href="http://nhibernate.jira.com">Issue tracker</a></li>
                            
                                
                                <li><a href="https://github.com/nhibernate/nhibernate-core">Source Code</a></li>
                            </ul>
                        <div style="clear: both;"></div>
                     </div></div>
                </div>
                
                        <div id="CommonNavigation2">
                            <div class="Common"><div class="Inner">
                                <ul>
                    
                        
                        <li><a href="../../../general/default.aspx.html">General</a></li>
                    
                        <li><a class="Selected" href="../../default.aspx.html">How to</a></li>
                        
                    
                        
                        <li><a href="../../../patternsandpractices/default.aspx.html">Patterns&Practices</a></li>
                    
                                </ul>
                            </div></div>
                        </div>
                    
                <div id="CommonNavigationShadow">
                    
    
    <div class="CommonBreadCrumbArea"><div class="Common">
        <a href="../../../index.html">Wikis</a>
        &raquo;
        <a href="../../default.aspx.html">How to</a>
        &raquo;
        <a href="../../nhibernate-audit-trails-and-onpreinsert-onpreupdate-event-listeners-vs-save-update-event-listeners.aspx.html">Changing Values in NHibernate Events</a>
        &raquo;
        Revision #8
    </div></div>


                </div>
		    
                        
            <div class="Common">
            
                
            
                <div id="CommonSearch">
                    
    
        
                <div class="CommonSearchArea">
                    <div class="CommonSearchRoundTop"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                    <div class="CommonSearchContent"><div class="CommonSearchContentInner">
                        <input name="ctl00$ctl00$sr$sr$ctl00$ctl00$TitleBarSearchText" type="text" maxlength="64" size="15" id="ctl00_ctl00_sr_sr_ctl00_ctl00_TitleBarSearchText" onclick="if(this.defaultValue==this.value) this.value='';" onblur="if(this.value=='') this.value=this.defaultValue;" onkeydown="return KeyDownHandlerctl00_ctl00_sr_sr_ctl00_ctl00_TitleBarSearchButton(event);" /><input type="submit" name="ctl00$ctl00$sr$sr$ctl00$ctl00$TitleBarSearchButton" value="Â " id="ctl00_ctl00_sr_sr_ctl00_ctl00_TitleBarSearchButton" class="CommonSearchButton" />
                    </div></div>
                    <div class="CommonSearchRoundBottom"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                </div>
            
    

                </div>
                <div id="CommonTitle">
                    
    
    <h1 class="CommonTitle">NHibernate, Audit trails and OnPreInsert/ OnPreUpdate event listeners vs Save/ Update event listeners: 
            Revision #8
        </h1>


                </div>
                <div style="clear: both;"></div>
			    <div id="CommonSidebarRight">
			        
    
	<div class="CommonSidebar">
	    
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Shortcuts</h4>
	                    <div class="CommonContentBoxContent">
	            <ul class='CommonSidebarList'><li><a href="../../default.aspx.html">Home</a></li><li><a href="../rss.aspx">RSS feed for page</a></li></ul>
				        </div>
				        
			        </div>
	            
	    
	        
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Wiki Page Hierarchy</h4>
	                    <div class="CommonContentBoxContent">
	            <div><ul class="CommonHierarchicalList"><li><a href="../../mapping-a-view-and-schema-export-workaround.aspx.html">Mapping a view and Schema Export Workaround</a></li><li><a href="../../lazy-loading-eager-loading.aspx.html">Lazy loading - eager loading</a></li><li><a href="../../configure-log4net-for-use-with-nhibernate.aspx.html">Configure Log4Net for use with NHibernate</a></li><li><a href="../../get-unique-results-from-joined-queries.aspx.html">Get unique results from joined queries</a></li><li><a href="8.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01._expand(30, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../your-first-nhibernate-based-application.aspx.html">Your first NHibernate based application</a></li><li><a href="../../run-in-medium-trust.aspx.html">Run in Medium Trust</a></li><li><a href="../../pre-generate-lazy-loading-proxies.aspx.html">Pre-Generate Lazy Loading Proxies</a></li><li><a href="8.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01._expand(42, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../using-user-types.aspx.html">Using User Types</a></li><li><a href="../../lazy-loaded-one-to-one-with-nhibernate.aspx.html">Lazy Loaded One-To-One With NHibernate </a></li><li><a href="../../dynamically-change-user-info-in-connection-string.aspx.html">Dynamically change user info in connection string</a></li><li><a href="../../contextual-data-using-nhibernate-filters.aspx.html">Contextual data using NHibernate filters</a></li><li><a href="../../mapping-the-same-class-to-a-view-and-a-table-using-entity-name.aspx.html">Mapping the same class to a view and a table using entity-name</a></li><li><a href="../../creating-an-audit-log-using-nhibernate-events.aspx.html">Creating an Audit Log using NHibernate Events</a></li><li><a href="8.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01._expand(51, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../create-a-custom-message-interpolator-for-nhibernate-validator.aspx.html">Create a custom message interpolator for NHibernate Validator</a></li><li><a href="../../use-postgresql-arrays-with-nhibernate.aspx.html">Use PostgreSQL Arrays with NHibernate</a></li><li><a href="../../retrieve-a-nested-component-with-criteria-api.aspx.html">Retrieve a nested component with Criteria API</a></li><li><a href="../../tuning-queries-with-ms-sqlserver.aspx.html">Tuning queries with MS SQLServer</a></li><li><a href="../../nhibernate-concurrency-with-oracle-s-ora-rowscn.aspx.html">NHibernate concurrency with Oracle&#39;s ORA_ROWSCN</a></li><li><a href="../../the-best-way-to-get-nhibernate-community-support-submit-precise-description-of-the-problem.aspx.html">The best way to get NHibernate community support ? Submit precise description of the problem</a></li><li><a href="../../simple-audit-metadata-and-logical-deletion-of-business-entities.aspx.html">Simple audit metadata and logical deletion of business entities</a></li><li><a href="../../prefent-nhibernate-from-saving-default-relations.aspx.html">Prefent NHibernate from saving default relations</a></li><li><a href="../../creating-a-custom-id-generator-for-nhibernate.aspx.html">Creating a custom id generator for nHibernate</a></li><li><a href="8.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01._expand(66, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../finding-dirty-properties-in-nhibernate.aspx.html">Finding Dirty Properties in NHibernate</a></li><li><a href="../../currentsessioncontext-for-desktop-development.aspx.html">CurrentSessionContext for Desktop development</a></li><li><a href="../../customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html">Customizing Fluent Nhibernate&#39;s AutoPersistenceModel Conventions</a></li><li><a href="../../how-to-use-db2hbm.aspx.html">How to use Db2hbm</a></li><li><a href="../../localization-techniques.aspx.html">Localization techniques</a></li><li><a href="../../calling-oracle-procedure-inside-package.aspx.html">Calling Oracle Procedure inside package</a></li><li><a href="../../how-to-get-help-with-nhibernate.aspx.html">How To Get Help with NHibernate</a></li><li><a href="../../nhibernate-features.aspx.html">NHibernate Features</a></li><li><a href="../../using-nlog-via-common-logging-with-nhibernate.aspx.html">Using NLog via Common.Logging with NHibernate</a></li><li><a href="../../keeping-entity-state-over-multiple-nhibernate-sessions.aspx.html">Keeping Entity State Over Multiple NHibernate Sessions</a></li><li><a href="../../enumerating-first-level-cache-entities.aspx.html">Enumerating First Level Cache Entities</a></li><li><a href="../../hilo-generator-with-node-suffix.aspx.html">HiLo Generator With Node Suffix</a></li><li><a href="../../nhibernate-audit-trails-and-onpreinsert-onpreupdate-event-listeners-vs-save-update-event-listeners.aspx.html" class="Selected">Changing Values in NHibernate Events</a></li><li><a href="../../conventionmodelmapper-amp-net-4-iset-lt-gt.aspx.html">ConventionModelMapper &amp; .net 4 ISet&lt;&gt;</a></li><li><a href="../../conventionmodelmapper-change-manytoone-column-name.aspx.html">ConventionModelMapper - change ManyToOne column name</a></li><li><a href="../../view-the-xml-generated-when-mapping-by-code.aspx.html">View the xml generated when mapping by code</a></li><li><a href="../../net-type-generation-for-nhibernate-mapping-collections.aspx.html">.NET type generation for NHibernate mapping collections</a></li><li><a href="../../a-fully-working-skeleton-for-sexy-loquacious-nh.aspx.html">A fully working skeleton for sexy Loquacious NH</a></li><li><a href="../../checking-if-an-unloaded-collection-contains-elements.aspx.html">Checking if an Unloaded Collection Contains Elements</a></li><li><a href="../../mapping-tables.aspx.html">Mapping tables</a></li><li><a href="../../wcf-nhibernate-entity-serialization.aspx.html">WCF + NHibernate: Entity Serialization</a></li></ul></div>
				        </div>
				        
			        </div>
	            
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Pages</h4>
	                    <div class="CommonContentBoxContent">
	            <div><ul class="CommonHierarchicalList"><li><a href="../../mapping-a-view-and-schema-export-workaround.aspx.html">Mapping a view and Schema Export Workaround</a></li><li><a href="../../lazy-loading-eager-loading.aspx.html">Lazy loading - eager loading</a></li><li><a href="../../configure-log4net-for-use-with-nhibernate.aspx.html">Configure Log4Net for use with NHibernate</a></li><li><a href="../../get-unique-results-from-joined-queries.aspx.html">Get unique results from joined queries</a></li><li><a href="8.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01._expand(30, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../your-first-nhibernate-based-application.aspx.html">Your first NHibernate based application</a></li><li><a href="../../run-in-medium-trust.aspx.html">Run in Medium Trust</a></li><li><a href="../../pre-generate-lazy-loading-proxies.aspx.html">Pre-Generate Lazy Loading Proxies</a></li><li><a href="8.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01._expand(42, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../using-user-types.aspx.html">Using User Types</a></li><li><a href="../../lazy-loaded-one-to-one-with-nhibernate.aspx.html">Lazy Loaded One-To-One With NHibernate </a></li><li><a href="../../dynamically-change-user-info-in-connection-string.aspx.html">Dynamically change user info in connection string</a></li><li><a href="../../contextual-data-using-nhibernate-filters.aspx.html">Contextual data using NHibernate filters</a></li><li><a href="../../mapping-the-same-class-to-a-view-and-a-table-using-entity-name.aspx.html">Mapping the same class to a view and a table using entity-name</a></li><li><a href="../../creating-an-audit-log-using-nhibernate-events.aspx.html">Creating an Audit Log using NHibernate Events</a></li><li><a href="8.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01._expand(51, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../create-a-custom-message-interpolator-for-nhibernate-validator.aspx.html">Create a custom message interpolator for NHibernate Validator</a></li><li><a href="../../use-postgresql-arrays-with-nhibernate.aspx.html">Use PostgreSQL Arrays with NHibernate</a></li><li><a href="../../retrieve-a-nested-component-with-criteria-api.aspx.html">Retrieve a nested component with Criteria API</a></li><li><a href="../../tuning-queries-with-ms-sqlserver.aspx.html">Tuning queries with MS SQLServer</a></li><li><a href="../../nhibernate-concurrency-with-oracle-s-ora-rowscn.aspx.html">NHibernate concurrency with Oracle&#39;s ORA_ROWSCN</a></li><li><a href="../../the-best-way-to-get-nhibernate-community-support-submit-precise-description-of-the-problem.aspx.html">The best way to get NHibernate community support ? Submit precise description of the problem</a></li><li><a href="../../simple-audit-metadata-and-logical-deletion-of-business-entities.aspx.html">Simple audit metadata and logical deletion of business entities</a></li><li><a href="../../prefent-nhibernate-from-saving-default-relations.aspx.html">Prefent NHibernate from saving default relations</a></li><li><a href="../../creating-a-custom-id-generator-for-nhibernate.aspx.html">Creating a custom id generator for nHibernate</a></li><li><a href="8.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01._expand(66, this); return false;"><img src="../../../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="../../finding-dirty-properties-in-nhibernate.aspx.html">Finding Dirty Properties in NHibernate</a></li><li><a href="../../currentsessioncontext-for-desktop-development.aspx.html">CurrentSessionContext for Desktop development</a></li><li><a href="../../customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html">Customizing Fluent Nhibernate&#39;s AutoPersistenceModel Conventions</a></li><li><a href="../../how-to-use-db2hbm.aspx.html">How to use Db2hbm</a></li><li><a href="../../localization-techniques.aspx.html">Localization techniques</a></li><li><a href="../../calling-oracle-procedure-inside-package.aspx.html">Calling Oracle Procedure inside package</a></li><li><a href="../../how-to-get-help-with-nhibernate.aspx.html">How To Get Help with NHibernate</a></li><li><a href="../../nhibernate-features.aspx.html">NHibernate Features</a></li><li><a href="../../using-nlog-via-common-logging-with-nhibernate.aspx.html">Using NLog via Common.Logging with NHibernate</a></li><li><a href="../../keeping-entity-state-over-multiple-nhibernate-sessions.aspx.html">Keeping Entity State Over Multiple NHibernate Sessions</a></li><li><a href="../../enumerating-first-level-cache-entities.aspx.html">Enumerating First Level Cache Entities</a></li><li><a href="../../hilo-generator-with-node-suffix.aspx.html">HiLo Generator With Node Suffix</a></li><li><a href="../../nhibernate-audit-trails-and-onpreinsert-onpreupdate-event-listeners-vs-save-update-event-listeners.aspx.html" class="Selected">Changing Values in NHibernate Events</a></li><li><a href="../../conventionmodelmapper-amp-net-4-iset-lt-gt.aspx.html">ConventionModelMapper &amp; .net 4 ISet&lt;&gt;</a></li><li><a href="../../conventionmodelmapper-change-manytoone-column-name.aspx.html">ConventionModelMapper - change ManyToOne column name</a></li><li><a href="../../view-the-xml-generated-when-mapping-by-code.aspx.html">View the xml generated when mapping by code</a></li><li><a href="../../net-type-generation-for-nhibernate-mapping-collections.aspx.html">.NET type generation for NHibernate mapping collections</a></li><li><a href="../../a-fully-working-skeleton-for-sexy-loquacious-nh.aspx.html">A fully working skeleton for sexy Loquacious NH</a></li><li><a href="../../checking-if-an-unloaded-collection-contains-elements.aspx.html">Checking if an Unloaded Collection Contains Elements</a></li><li><a href="../../mapping-tables.aspx.html">Mapping tables</a></li><li><a href="../../wcf-nhibernate-entity-serialization.aspx.html">WCF + NHibernate: Entity Serialization</a></li></ul></div>
				        </div>
				        
			        </div>
	            
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Tags</h4>
	                    <div class="CommonContentBoxContent">
	            <ul class="CommonSidebarTagCloud">
<li class="CommonTag6"><a href="../../tags/equality/default.aspx.html" rel="tag">equality</a></li>
<li class="CommonTag6"><a href="../../tags/identity/default.aspx.html" rel="tag">identity</a></li>
<li class="CommonTag1"><a href="../../tags/pattern/default.aspx.html" rel="tag">pattern</a></li>
<li class="CommonTag6"><a href="../../tags/unit+of+work/default.aspx.html" rel="tag">unit of work</a></li>
</ul>

				        </div>
				        <div class="CommonContentBoxFooter"><a href="../../tags/default.aspx.html">View more</a></div>
			        </div>
	            
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Page Details</h4>
	                    <div class="CommonContentBoxContent">
	            <div class="CustomWikiPageDetailsArea"><div class="CustomWikiPageDetailsTitle">First published by:</div><div class="CustomWikiPageDetailsAvatar"><img src="../../../../resized-image.ashx/__size/50x50/__key/CommunityServer.Components.Avatars/00.00.01.63.82/4TIFQBET4D75.jpg" alt="" style="border-width:0px;" /></div><div class="CustomWikiPageDetailsContent"><a href="../../../../members/Scott-Findlater/default.aspx.html">Scott Findlater</a><br/> on 04-26-2011</div></div><div class="CustomWikiPageDetailsArea"><div class="CustomWikiPageDetailsTitle">Last revision by:</div><div class="CustomWikiPageDetailsAvatar"><img src="../../../../utility/anonymous.gif" alt="" style="border-width:0px;max-height:50px;max-width:50px;" /></div><div class="CustomWikiPageDetailsContent"><a href="../../../../members/flcdrg/default.aspx.html">David Gardiner</a><br/> on 07-06-2012</div></div><div class="WikiPageDetailsSummaryArea"><strong>2</strong> people found this article useful.</div>
				        </div>
				        
			        </div>
	            
	    
	    
	    
    </div>
    

			    </div>
                <div id="CommonSidebarLeft">
				    
				</div>
			    <div id="CommonContent"><div id="CommonContentInner">
    



<div class="CommonContentBox">
    <div class="CommonContentBoxContent">
        <div style="float: right">
            
        </div>
        
        <div class="CommonPaneTabSet">
            <div style="overflow: hidden; width: 100%;">
                <table border="0" cellpadding="0" cellspacing="0">
                <tbody>
                    <tr>
                        <td>
                            <div class="CommonPaneTab">
                                <a href="../../nhibernate-audit-trails-and-onpreinsert-onpreupdate-event-listeners-vs-save-update-event-listeners.aspx.html"><img align="absmiddle" border="0" src="../../../../Themes/hawaii/images/wiki/wiki-icon-article-tab.png" alt="" style="border-width:0px;" /></a>                            
                                <a href="../../nhibernate-audit-trails-and-onpreinsert-onpreupdate-event-listeners-vs-save-update-event-listeners.aspx.html">Article</a>
                            </div>
                        </td>
                        <td>
                            
                                    <div class="CommonPaneTab">
                                    
                                    
                                    </div>
                                
                        </td>
                        <td>
                            <div class="CommonPaneTab">
                                <a href="../comments.aspx.html"><img align="absmiddle" border="0" src="../../../../Themes/hawaii/images/wiki/wiki-icon-comment-tab.png" alt="" style="border-width:0px;" /></a>
                                <a href="../comments.aspx.html">Comments</a> (1)
                            </div>
                        </td>
                        <td>
                            <div class="CommonPaneTabSelected">
                                <a href="../history.aspx.html"><img align="absmiddle" border="0" src="../../../../Themes/hawaii/images/wiki/wiki-icon-history-tab.png" alt="" style="border-width:0px;" /></a>
                                <a href="../history.aspx.html">History</a> (12)
                            </div>
                        </td>
                    </tr>
                </tbody>
                </table>
            </div>
        </div>

        <div class="CommonPane">
            <div class="CommonGroupedContentArea">
                <h2 class="CommonContentBoxHeaderSmall"><span><a href="../../nhibernate-audit-trails-and-onpreinsert-onpreupdate-event-listeners-vs-save-update-event-listeners.aspx.html">Changing Values in NHibernate Events</a></span></h2>
                <div><h2>Abstract</h2>
<p>Audit trails using NHibernate&#39;s event model often
use the OnPreInsert and OnPreUpdate event listeners to change/ modify the state
of the entity.&nbsp; While this does works and
is widely documented as a solution, it should be noted the OnPreInsert and
OnPreUpdate events are not intended to be used to change the values of the
entity and instead they should be used to check values and for that reason they
return &quot;veto&quot;.</p>
<h2><b>Code</b></h2>
<p>The full solution <a href="http://www.scottfindlater.co.uk/blog/nhibernate-audit-trails-and-onpreinsert-onpreupdate-event-listeners-vs-save-update-event-listeners">can be downloaded here</a>.&nbsp; The <b>tests</b>
folder in each project highlights successes/ issues (by failing tests) in each
project.&nbsp; May I politely ask you to bear
in mind the aim of this code is the issue of <b>inheritance</b> and they have been over simplified with auditing in
mind to demonstrate inheritance issues within NHibernate ... this is not a
commercial design pattern/ solution.</p>
<p><b>
Project - 01OnPreEvents</b>.&nbsp; This project shows a typical, working,
approach to audit trails using the OnPreInsert and OnPreUpdate to modify the
entity state.&nbsp; An <b>Entity</b> base class which is inherited by a <b>Category</b> class.&nbsp; The base <b>Entity</b> provides identification and
common auditing properties.</p>
<p><b>
Project - 02OnPreEventsFailing</b>.&nbsp; This project shows how an inheritance entity
hierarchy using the OnPreInsert and OnPreUpdate events to modify entity state
fail to persist the changed entity state.&nbsp;
Here, for whatever design decision, the <b>Entity</b> base class which originally provide identification and
common auditing has been split into <b>Entity</b>
and <b>AuditableEntity</b>.&nbsp; Now the <b>Category</b>
class inherits from <b>AuditableEntity</b>.</p>
<p><b>Project - 03Save</b>.&nbsp; Uses the same entity inheritance hierarchy
from the <b>02OnPreEventsFailing</b> project
to demonstrate a working version using the Save/ Insert events.</p>
<h2><b>History<br /></b></h2>
<p>This section is the history of arriving at this
post.&nbsp; Please read this with the spirit
of sharing and attempting to contribute to documentation.</p>
<p>Audit trails using NHibernate&#39;s event model are well
documented;</p>
<ul class="unIndentedList">
<li> <a href="http://ayende.com/Blog/archive/2009/04/29/nhibernate-ipreupdateeventlistener-amp-ipreinserteventlistener.aspx">Ayende&#39;s
NHibernate IPreUpdateEventListener &amp; IPreInsertEventListener blog post</a></li>
<li> <a href="../../creating-an-audit-log-using-nhibernate-events.aspx.html">Graham
Bunce&#39;s Creating an Audit Log using NHibernate Events on this WIKI</a></li>
<li> And most recently Jason <a href="http://www.packtpub.com/nhibernate-3-0-cookbook/book">Dentler&#39;s
NHibernate 3.0 cookbook</a>, chapter 7, Creating and
changing stamping entities recipe. </li>
</ul>
<p>And there is no doubt all of these solutions work
using the concept of changing the state of the entity before (pre) database
insertion or updating.</p>
<p>I adopted the OnPreInsert and OnPreUpdate approach
for an auditing solution within an inheritance architected solution when I found,
what I thought, was an NHibernate bug.&nbsp; I
subsequently ended up at <a href="http://216.121.112.228/browse/NH-2596">this
NHibernate bug report - changes made in IPreInsert/UpdateEventListener are not
persisted into DB on inherited classes</a> with the unexpected
resolution of &quot;not an issue&quot;.&nbsp; </p>
<p>The solution proposed was to use the Save/ Update
event listeners, which obviously works, but the unexpected reason as to why
this report was not a bug was because &quot;<i>pre-insert
and pre-update listeners are not intended to be used to change the values of
the entity. Instead they should be used to check-values (for that reason they
return &quot;veto&quot;).&quot;</i> (<a href="http://216.121.112.228/browse/NH-2596?focusedCommentId=20776&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_20776">see
in context</a>) </p>
<p>This contradiction of intended usage regarding the
changing of entity state was further discussed on this <a href="http://groups.google.com/group/nhusers/browse_thread/thread/b6807c2a486073d8">NHUser
Group thread</a>, with the same answer.</p>
<h2><b>Conclusion</b></h2>
<p>I note Fabio clearly states the usage for the OnPre*
events and herewith is some documentation.&nbsp;
However, from the perspective of a developer learning NHibernate, I feel
this is contradicted by key NHibernate community people.&nbsp; </p>
<p>I am yet to truly understand why, with the variety
of scenarios demonstrated, this is a not considered a bug.&nbsp; Maybe there should be some explicit enforcing
of not being able to change entity state in these OnPre* events.</p>
<h3>A detailed example from Fabio?</h3>
<p>There seem to be alot of cries for help but with no conclusive working examples;</p>
<ul>
<li><a href="https://groups.google.com/forum/#!topic/nhusers/0kugoXFPeGw/discussion">audit listener using IFlushEntityEventListener (continuation of NH-2596)</a></li>
<li><a href="http://groups.google.com/group/nhusers/browse_thread/thread/10d7c2542e3849af">Bizarre error when using NHibernate, IPreInsertEventListener, Oracle, batching and sequences </a></li>
<li><a href="http://groups.google.com/group/nhusers/browse_thread/thread/b6807c2a486073d8">Clarification on NH-2596 of PreUpdate vs OnSaveOrUpdate semantics </a></li>
</ul></div>
            </div>
        </div>

    </div>
</div>


</div></div>
			    <div style="clear: both;"></div>
			    
			    
            </div>
                
            <div id="CommonFooter">
                <div class="Common">
                    
                        
                	    
                        

                        
                                <a href="http://communityserver.com/" target="_blank"><img src="../../../../utility/PoweredByCS_commercial.gif" alt="Powered by Community Server (Commercial Edition), by Telligent Systems " style="border-width:0px;" /></a>
		                    
                		
                    
                 </div>
            </div>
		
<script type="text/javascript">
// <![CDATA[
Telligent_Modal.Configure('/utility/loading.htm',['CommonModal'],['CommonModalTitle'],['CommonModalClose'],['CommonModalContent'],['CommonModalFooter'],['CommonModalResize'],['CommonModalMask'],100,false,true);
// ]]>
</script><script type="text/javascript">
<!--
function KeyDownHandlerctl00_ctl00_sr_sr_ctl00_ctl00_TitleBarSearchButton(event)
{
	if (event.keyCode == 13)
	{
		event.returnValue = false;
		event.cancel = true;
     __doPostBack('ctl00$ctl00$sr$sr$ctl00$ctl00$TitleBarSearchButton','')
   return false;
	}
}

//-->
</script>
<script type="text/javascript">
// <![CDATA[
window.ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01=new WikiPageHierarchy('ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01',new Function('mode','pageId','callback','WebForm_DoCallback(\'ctl00$ctl00$rcr$rcr$ctl00$ctl02$ctl00$ctl01$ctl01\',mode + \':\' + pageId,callback,\"\",null,false)'),'<img src="http://nhforge.org/wikis/howtonh/changing-values-in-nhibernate-events/revision/\&quot;/WebResource.axd?d=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000\&quot;" alt=\"+\" style=\"border-width: 0;\" />','<img src="http://nhforge.org/wikis/howtonh/changing-values-in-nhibernate-events/revision/\&quot;/WebResource.axd?d=I7Z2L5Ca7ffItUeObf-LA3ykZ3Mbmr-vwfNJv2PfNk2O4alHWIJbJADyKhl0k71mJCpGTePjifKqZQx_Rs64LrGhlEU25qRjlCh8LoYwo2tck8EIbBdQKg5CISopk9hz_6ZbK_GNtBJljwOq57_FBvxYCTM1&amp;t=634395149500000000\&quot;" alt=\"-\" style=\"border-width: 0;\" />','<div>Loading...</div>');
// ]]>
</script><script type="text/javascript">
// <![CDATA[
window.ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01=new WikiPageHierarchy('ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01',new Function('mode','pageId','callback','WebForm_DoCallback(\'ctl00$ctl00$rcr$rcr$ctl00$ctl03$ctl00$ctl01$ctl01\',mode + \':\' + pageId,callback,\"\",null,false)'),'<img src="http://nhforge.org/wikis/howtonh/changing-values-in-nhibernate-events/revision/\&quot;/WebResource.axd?d=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000\&quot;" alt=\"+\" style=\"border-width: 0;\" />','<img src="http://nhforge.org/wikis/howtonh/changing-values-in-nhibernate-events/revision/\&quot;/WebResource.axd?d=I7Z2L5Ca7ffItUeObf-LA3ykZ3Mbmr-vwfNJv2PfNk2O4alHWIJbJADyKhl0k71mJCpGTePjifKqZQx_Rs64LrGhlEU25qRjlCh8LoYwo2tck8EIbBdQKg5CISopk9hz_6ZbK_GNtBJljwOq57_FBvxYCTM1&amp;t=634395149500000000\&quot;" alt=\"-\" style=\"border-width: 0;\" />','<div>Loading...</div>');
// ]]>
</script><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5443308-1");
pageTracker._trackPageview();
</script></form>
		
	</body>
</html>
